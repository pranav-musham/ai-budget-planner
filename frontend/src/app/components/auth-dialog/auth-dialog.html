<div class="auth-dialog">
  <div class="dialog-header">
    <h2 mat-dialog-title>Welcome to Budget Tracker</h2>
    <button mat-icon-button (click)="onCancel()" class="close-button">
      <mat-icon>close</mat-icon>
    </button>
  </div>

  <mat-dialog-content>
    <mat-tab-group [(selectedIndex)]="selectedTabIndex" class="auth-tabs">
      <!-- Login Tab -->
      <mat-tab label="Login">
        <div class="tab-content">
          <form [formGroup]="loginForm" (ngSubmit)="onLoginSubmit()">
            <mat-form-field appearance="outline" class="full-width">
              <mat-label>Email</mat-label>
              <input matInput type="email" formControlName="email" placeholder="your@email.com" />
              <mat-icon matPrefix>email</mat-icon>
              <mat-error *ngIf="loginForm.get('email')?.hasError('required')">
                Email is required
              </mat-error>
              <mat-error *ngIf="loginForm.get('email')?.hasError('email')">
                Please enter a valid email
              </mat-error>
            </mat-form-field>

            <mat-form-field appearance="outline" class="full-width">
              <mat-label>Password</mat-label>
              <input
                matInput
                [type]="hideLoginPassword ? 'password' : 'text'"
                formControlName="password"
                placeholder="Enter your password"
              />
              <mat-icon matPrefix>lock</mat-icon>
              <button
                mat-icon-button
                matSuffix
                type="button"
                (click)="hideLoginPassword = !hideLoginPassword"
                [attr.aria-label]="'Toggle password visibility'"
              >
                <mat-icon>{{ hideLoginPassword ? 'visibility_off' : 'visibility' }}</mat-icon>
              </button>
              <mat-error *ngIf="loginForm.get('password')?.hasError('required')">
                Password is required
              </mat-error>
              <mat-error *ngIf="loginForm.get('password')?.hasError('minlength')">
                Password must be at least 6 characters
              </mat-error>
            </mat-form-field>

            <div class="error-message" *ngIf="loginErrorMessage">
              <mat-icon>error</mat-icon>
              <span>{{ loginErrorMessage }}</span>
            </div>

            <button
              mat-raised-button
              color="primary"
              type="submit"
              [disabled]="loginForm.invalid || isLoginLoading"
              class="full-width submit-button"
            >
              <mat-spinner diameter="20" *ngIf="isLoginLoading"></mat-spinner>
              <span *ngIf="!isLoginLoading">Login</span>
            </button>
          </form>
        </div>
      </mat-tab>

      <!-- Register Tab -->
      <mat-tab label="Register">
        <div class="tab-content">
          <form [formGroup]="registerForm" (ngSubmit)="onRegisterSubmit()">
            <mat-form-field appearance="outline" class="full-width">
              <mat-label>Email</mat-label>
              <input matInput type="email" formControlName="email" placeholder="your@email.com" />
              <mat-icon matPrefix>email</mat-icon>
              <mat-error *ngIf="registerForm.get('email')?.hasError('required')">
                Email is required
              </mat-error>
              <mat-error *ngIf="registerForm.get('email')?.hasError('email')">
                Please enter a valid email
              </mat-error>
            </mat-form-field>

            <mat-form-field appearance="outline" class="full-width">
              <mat-label>Full Name (Optional)</mat-label>
              <input matInput type="text" formControlName="fullName" placeholder="John Doe" />
              <mat-icon matPrefix>person</mat-icon>
            </mat-form-field>

            <mat-form-field appearance="outline" class="full-width">
              <mat-label>Password</mat-label>
              <input
                matInput
                [type]="hideRegisterPassword ? 'password' : 'text'"
                formControlName="password"
                placeholder="At least 8 characters"
              />
              <mat-icon matPrefix>lock</mat-icon>
              <button
                mat-icon-button
                matSuffix
                type="button"
                (click)="hideRegisterPassword = !hideRegisterPassword"
                [attr.aria-label]="'Toggle password visibility'"
              >
                <mat-icon>{{ hideRegisterPassword ? 'visibility_off' : 'visibility' }}</mat-icon>
              </button>
              <mat-error *ngIf="registerForm.get('password')?.hasError('required')">
                Password is required
              </mat-error>
              <mat-error *ngIf="registerForm.get('password')?.hasError('minlength')">
                Password must be at least 8 characters
              </mat-error>
              <mat-error *ngIf="registerForm.get('password')?.hasError('pattern')">
                Must include uppercase, lowercase, number, and special character
              </mat-error>
            </mat-form-field>

            <mat-form-field appearance="outline" class="full-width">
              <mat-label>Confirm Password</mat-label>
              <input
                matInput
                [type]="hideConfirmPassword ? 'password' : 'text'"
                formControlName="confirmPassword"
                placeholder="Re-enter password"
              />
              <mat-icon matPrefix>lock</mat-icon>
              <button
                mat-icon-button
                matSuffix
                type="button"
                (click)="hideConfirmPassword = !hideConfirmPassword"
                [attr.aria-label]="'Toggle password visibility'"
              >
                <mat-icon>{{ hideConfirmPassword ? 'visibility_off' : 'visibility' }}</mat-icon>
              </button>
              <mat-error *ngIf="registerForm.get('confirmPassword')?.hasError('required')">
                Please confirm your password
              </mat-error>
              <mat-error *ngIf="registerForm.hasError('passwordMismatch') && registerForm.get('confirmPassword')?.touched">
                Passwords do not match
              </mat-error>
            </mat-form-field>

            <div class="error-message" *ngIf="registerErrorMessage">
              <mat-icon>error</mat-icon>
              <span>{{ registerErrorMessage }}</span>
            </div>

            <button
              mat-raised-button
              color="primary"
              type="submit"
              [disabled]="registerForm.invalid || isRegisterLoading"
              class="full-width submit-button"
            >
              <mat-spinner diameter="20" *ngIf="isRegisterLoading"></mat-spinner>
              <span *ngIf="!isRegisterLoading">Create Account</span>
            </button>
          </form>
        </div>
      </mat-tab>
    </mat-tab-group>
  </mat-dialog-content>
</div>
